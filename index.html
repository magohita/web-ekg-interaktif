<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edukasi EKG Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }
        .tab-button.active {
            border-bottom-color: #2563eb;
            color: #2563eb;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-6 py-4">
            <h1 class="text-2xl md:text-3xl font-bold text-blue-600">Pendidikan EKG Interaktif</h1>
            <p class="mt-1 text-gray-600">Meningkatkan Kualitas Interpretasi Klinis oleh Tenaga Kesehatan</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        
        <!-- Introduction Section -->
        <section id="pendahuluan" class="mb-12">
            <div class="card p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Selamat Datang!</h2>
                <p class="text-gray-700 leading-relaxed">
                    Interpretasi elektrokardiogram (EKG) adalah kompetensi klinis krusial untuk deteksi dini gangguan irama jantung. Namun, banyak tenaga kesehatan menghadapi kesulitan karena terbatasnya waktu pelatihan. Platform web interaktif ini dirancang sebagai solusi pembelajaran yang fleksibel dan mandiri. Melalui simulasi, kuis, dan studi kasus, kami berharap dapat meningkatkan akurasi, kecepatan, dan kepercayaan diri Anda dalam mengambil keputusan klinis terkait EKG.
                </p>
            </div>
        </section>

        <!-- Interactive Learning Section -->
        <section id="pembelajaran">
            <div class="card">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-6 px-6" aria-label="Tabs">
                        <button onclick="changeTab(event, 'simulasi')" class="tab-button active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                            Simulasi EKG
                        </button>
                        <button onclick="changeTab(event, 'materi')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                            Materi Dasar
                        </button>
                        <button onclick="changeTab(event, 'kuis')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                            Kuis Interaktif
                        </button>
                    </nav>
                </div>

                <!-- Tab: EKG Simulation -->
                <div id="simulasi" class="tab-content active p-6">
                    <h3 class="text-xl font-bold mb-2">Simulasi EKG Interaktif</h3>
                    <p class="mb-4 text-gray-600">Pilih jenis irama jantung untuk melihat simulasinya secara langsung.</p>
                    
                    <div class="bg-green-900 border-4 border-gray-700 rounded-lg p-2 mb-4">
                        <canvas id="ekgCanvas"></canvas>
                    </div>

                    <div id="ekg-info" class="text-center mb-4 p-3 bg-blue-100 text-blue-800 rounded-lg">
                        <p class="font-semibold text-lg" id="rhythmName">Normal Sinus Rhythm</p>
                        <p class="text-sm" id="rhythmDesc">Irama jantung normal, berkisar antara 60-100 denyut per menit.</p>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button onclick="setRhythm('normal')" class="btn bg-green-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-600">Normal Sinus</button>
                        <button onclick="setRhythm('tachycardia')" class="btn bg-orange-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-orange-600">Tachycardia</button>
                        <button onclick="setRhythm('bradycardia')" class="btn bg-blue-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600">Bradycardia</button>
                        <button onclick="setRhythm('afib')" class="btn bg-red-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-red-600">Atrial Fibrillation</button>
                    </div>
                </div>

                <!-- Tab: Learning Material -->
                <div id="materi" class="tab-content p-6">
                    <h3 class="text-xl font-bold mb-4">Dasar-Dasar Interpretasi EKG</h3>
                    <div class="space-y-6">
                        <div>
                            <h4 class="font-semibold text-lg">Gelombang Normal EKG</h4>
                            <img src="https://placehold.co/600x200/e2e8f0/4a5568?text=Gelombang+EKG+Normal+(P-QRS-T)" alt="Gelombang EKG Normal" class="w-full max-w-lg mx-auto my-4 rounded-lg bg-gray-200">
                            <p class="text-gray-700">Satu siklus detak jantung pada EKG terdiri dari beberapa komponen utama:</p>
                            <ul class="list-disc list-inside mt-2 space-y-1 text-gray-600">
                                <li><strong>Gelombang P:</strong> Mewakili depolarisasi (kontraksi) atrium.</li>
                                <li><strong>Kompleks QRS:</strong> Mewakili depolarisasi (kontraksi) ventrikel. Ini adalah komponen terbesar.</li>
                                <li><strong>Gelombang T:</strong> Mewakili repolarisasi (relaksasi) ventrikel.</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold text-lg">Kertas EKG</h4>
                            <p class="text-gray-700">Kertas EKG memiliki grid standar. Satu kotak kecil berukuran 1 mm dan mewakili 0.04 detik (sumbu horizontal) dan 0.1 mV (sumbu vertikal). Satu kotak besar (5x5 kotak kecil) mewakili 0.20 detik.</p>
                        </div>
                    </div>
                </div>

                <!-- Tab: Interactive Quiz -->
                <div id="kuis" class="tab-content p-6">
                    <h3 class="text-xl font-bold mb-4">Kuis: Identifikasi Irama Jantung</h3>
                    <div id="quiz-container">
                        <p class="mb-4 text-gray-600">Amati simulasi EKG di bawah ini dan tentukan jenis irama jantungnya.</p>
                        <div class="bg-green-900 border-4 border-gray-700 rounded-lg p-2 mb-4">
                            <canvas id="quizEkgCanvas"></canvas>
                        </div>
                        <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <!-- Options will be generated by JS -->
                        </div>
                        <div id="quiz-feedback" class="mt-4 p-3 rounded-lg text-center font-semibold hidden"></div>
                        <button id="next-question-btn" onclick="nextQuestion()" class="btn mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 hidden">Pertanyaan Berikutnya</button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white mt-12 py-6 border-t">
        <div class="container mx-auto px-6 text-center text-gray-600">
            <p>&copy; 2024 - Edukasi EKG Interaktif.</p>
            <p class="text-sm mt-1">Dikembangkan oleh Kelompok V (Gilbert, Grecilya J., William KM) - Universitas Prima Indonesia</p>
        </div>
    </footer>

    <script>
        // --- Tab Logic ---
        function changeTab(event, tabID) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));

            document.getElementById(tabID).classList.add('active');
            event.currentTarget.classList.add('active');

            // Re-initialize canvases if they are now visible
            if (tabID === 'simulasi') {
                initCanvas('ekgCanvas', 'normal');
            } else if (tabID === 'kuis') {
                startQuiz();
            }
        }

        // --- EKG Simulation Logic ---
        const canvas = document.getElementById('ekgCanvas');
        const ctx = canvas.getContext('2d');
        let animationFrameId;
        let currentRhythm = 'normal';
        let x = 0;

        const rhythms = {
            normal: {
                name: 'Normal Sinus Rhythm',
                desc: 'Irama jantung normal, berkisar antara 60-100 denyut per menit.',
                speed: 1.5,
                pattern: [0,0,0,0,0, 5,10,5,0, -5,-15,-5,0, 50, -90, 40, -10, 5, 0, 10, 20, 25, 20, 10, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
            },
            tachycardia: {
                name: 'Tachycardia',
                desc: 'Detak jantung lebih cepat dari normal, >100 denyut per menit.',
                speed: 3,
                pattern: [0,0, 5,10,5,0, -5,-15,-5,0, 50, -90, 40, -10, 5, 0, 10, 20, 25, 20, 10, 0,0,0,0,0,0,0,0,0,0]
            },
            bradycardia: {
                name: 'Bradycardia',
                desc: 'Detak jantung lebih lambat dari normal, <60 denyut per menit.',
                speed: 0.8,
                pattern: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 5,10,5,0, -5,-15,-5,0, 50, -90, 40, -10, 5, 0, 10, 20, 25, 20, 10, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
            },
            afib: {
                name: 'Atrial Fibrillation',
                desc: 'Irama jantung tidak teratur dan seringkali cepat (irregularly irregular).',
                speed: 2.5,
                pattern: [0, 5, -3, 8, -5, 5, 0, 40, -70, 30, 0, 5, -2, 6, -4, 0, 0, 0, 5, -3, 4, 0, 30, -60, 25, 0, 0, 6, -2, 8, -5, 0, 50, -95, 45, 0]
            }
        };

        function drawGrid(canvasElement, context) {
            const width = canvasElement.width;
            const height = canvasElement.height;
            context.clearRect(0, 0, width, height);
            context.strokeStyle = '#38a169'; // Darker green for grid
            context.lineWidth = 0.5;

            // Minor grid lines
            for (let i = 0; i < width; i += 5) {
                context.beginPath();
                context.moveTo(i, 0);
                context.lineTo(i, height);
                context.stroke();
            }
            for (let i = 0; i < height; i += 5) {
                context.beginPath();
                context.moveTo(0, i);
                context.lineTo(width, i);
                context.stroke();
            }

            // Major grid lines
            context.strokeStyle = '#4a5568'; // A bit more prominent
            context.lineWidth = 1;
            for (let i = 0; i < width; i += 25) {
                context.beginPath();
                context.moveTo(i, 0);
                context.lineTo(i, height);
                context.stroke();
            }
            for (let i = 0; i < height; i += 25) {
                context.beginPath();
                context.moveTo(0, i);
                context.lineTo(width, i);
                context.stroke();
            }
        }

        function animateEKG(canvasElement, context, rhythmKey) {
            const rhythmData = rhythms[rhythmKey];
            const pattern = rhythmData.pattern;
            const speed = rhythmData.speed;
            const width = canvasElement.width;
            const height = canvasElement.height;
            const centerY = height / 2;

            function loop() {
                // Get the image data of the last frame
                const imageData = context.getImageData(speed, 0, width - speed, height);
                // Redraw grid on the cleared part
                drawGrid(canvasElement, context);
                // Put the shifted image back
                context.putImageData(imageData, 0, 0);

                // Draw the new line segment on the right
                const patternIndex = Math.floor(x / speed) % pattern.length;
                const prevPatternIndex = (patternIndex === 0) ? pattern.length - 1 : patternIndex - 1;
                
                const y1 = centerY - pattern[prevPatternIndex] * (height / 400);
                const y2 = centerY - pattern[patternIndex] * (height / 400);

                context.beginPath();
                context.moveTo(width - speed, y1);
                context.lineTo(width, y2);
                context.strokeStyle = '#68d391'; // Bright green for EKG line
                context.lineWidth = 2.5;
                context.stroke();
                
                x += speed;
                animationFrameId = requestAnimationFrame(loop);
            }

            cancelAnimationFrame(animationFrameId);
            loop();
        }

        function setRhythm(rhythmKey) {
            currentRhythm = rhythmKey;
            const rhythmInfo = rhythms[rhythmKey];
            document.getElementById('rhythmName').innerText = rhythmInfo.name;
            document.getElementById('rhythmDesc').innerText = rhythmInfo.desc;
            initCanvas('ekgCanvas', rhythmKey);
        }

        function initCanvas(canvasId, rhythmKey) {
            const canvasEl = document.getElementById(canvasId);
            if (!canvasEl) return;
            const ctxEl = canvasEl.getContext('2d');
            
            const container = canvasEl.parentElement;
            canvasEl.width = container.clientWidth;
            canvasEl.height = container.clientHeight > 0 ? container.clientHeight : 200;

            x = 0;
            cancelAnimationFrame(animationFrameId);
            drawGrid(canvasEl, ctxEl);
            animateEKG(canvasEl, ctxEl, rhythmKey);
        }

        // --- Quiz Logic ---
        const quizCanvas = document.getElementById('quizEkgCanvas');
        const quizCtx = quizCanvas.getContext('2d');
        let quizAnimationId;

        const quizQuestions = [
            { rhythm: 'tachycardia', options: ['Normal Sinus', 'Tachycardia', 'Bradycardia', 'Atrial Fibrillation'], answer: 'Tachycardia' },
            { rhythm: 'bradycardia', options: ['Bradycardia', 'Tachycardia', 'Normal Sinus', 'Atrial Fibrillation'], answer: 'Bradycardia' },
            { rhythm: 'afib', options: ['Normal Sinus', 'Tachycardia', 'Atrial Fibrillation', 'Bradycardia'], answer: 'Atrial Fibrillation' },
            { rhythm: 'normal', options: ['Tachycardia', 'Atrial Fibrillation', 'Bradycardia', 'Normal Sinus'], answer: 'Normal Sinus' }
        ];
        let currentQuestionIndex = 0;
        let score = 0;

        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            loadQuestion();
        }

        function loadQuestion() {
            const question = quizQuestions[currentQuestionIndex];
            const optionsContainer = document.getElementById('quiz-options');
            const feedbackEl = document.getElementById('quiz-feedback');
            const nextBtn = document.getElementById('next-question-btn');

            feedbackEl.classList.add('hidden');
            nextBtn.classList.add('hidden');
            optionsContainer.innerHTML = '';

            // Animate quiz EKG
            const canvasEl = document.getElementById('quizEkgCanvas');
            const container = canvasEl.parentElement;
            canvasEl.width = container.clientWidth;
            canvasEl.height = 200;
            cancelAnimationFrame(quizAnimationId);
            
            let quizX = 0;
            function animateQuizEKG() {
                const rhythmData = rhythms[question.rhythm];
                const pattern = rhythmData.pattern;
                const speed = rhythmData.speed;
                const width = canvasEl.width;
                const height = canvasEl.height;
                const centerY = height / 2;

                const imageData = quizCtx.getImageData(speed, 0, width - speed, height);
                drawGrid(canvasEl, quizCtx);
                quizCtx.putImageData(imageData, 0, 0);

                const patternIndex = Math.floor(quizX / speed) % pattern.length;
                const prevPatternIndex = (patternIndex === 0) ? pattern.length - 1 : patternIndex - 1;
                
                const y1 = centerY - pattern[prevPatternIndex] * (height / 400);
                const y2 = centerY - pattern[patternIndex] * (height / 400);

                quizCtx.beginPath();
                quizCtx.moveTo(width - speed, y1);
                quizCtx.lineTo(width, y2);
                quizCtx.strokeStyle = '#68d391';
                quizCtx.lineWidth = 2.5;
                quizCtx.stroke();
                
                quizX += speed;
                quizAnimationId = requestAnimationFrame(animateQuizEKG);
            }
            animateQuizEKG();

            // Create option buttons
            question.options.forEach(option => {
                const button = document.createElement('button');
                button.innerText = option;
                button.classList.add('btn', 'bg-gray-200', 'text-gray-800', 'font-semibold', 'py-3', 'px-4', 'rounded-lg', 'hover:bg-gray-300');
                button.onclick = () => checkAnswer(option);
                optionsContainer.appendChild(button);
            });
        }

        function checkAnswer(selectedOption) {
            cancelAnimationFrame(quizAnimationId); // Stop animation on answer
            const question = quizQuestions[currentQuestionIndex];
            const feedbackEl = document.getElementById('quiz-feedback');
            const nextBtn = document.getElementById('next-question-btn');
            
            document.querySelectorAll('#quiz-options button').forEach(btn => btn.disabled = true);

            if (selectedOption === question.answer) {
                feedbackEl.innerText = 'Benar! Ini adalah ' + question.answer;
                feedbackEl.className = 'mt-4 p-3 rounded-lg text-center font-semibold bg-green-100 text-green-800';
                score++;
            } else {
                feedbackEl.innerText = 'Salah. Jawaban yang benar adalah ' + question.answer;
                feedbackEl.className = 'mt-4 p-3 rounded-lg text-center font-semibold bg-red-100 text-red-800';
            }
            feedbackEl.classList.remove('hidden');
            nextBtn.classList.remove('hidden');
            
            if (currentQuestionIndex === quizQuestions.length - 1) {
                nextBtn.innerText = 'Lihat Hasil';
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizQuestions.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            const quizContainer = document.getElementById('quiz-container');
            quizContainer.innerHTML = `
                <h3 class="text-xl font-bold mb-4 text-center">Kuis Selesai!</h3>
                <p class="text-center text-lg mb-4">Skor Anda: <span class="font-bold text-blue-600">${score}</span> dari ${quizQuestions.length}</p>
                <div class="text-center">
                    <button onclick="startQuiz()" class="btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700">Ulangi Kuis</button>
                </div>
            `;
        }

        // --- Initial Load ---
        window.addEventListener('DOMContentLoaded', () => {
            initCanvas('ekgCanvas', 'normal');
            window.addEventListener('resize', () => {
                if(document.getElementById('simulasi').classList.contains('active')) {
                    initCanvas('ekgCanvas', currentRhythm);
                }
                if(document.getElementById('kuis').classList.contains('active')) {
                   // Quiz canvas will resize on next question
                }
            });
        });
    </script>

</body>
</html>
